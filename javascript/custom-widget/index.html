<!DOCTYPE HTML>
<!--
	Alpha by HTML5 UP
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>ArcGIS for Developers 開発リソース集</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="../../assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="../../assets/css/main.css" />
		<link rel="stylesheet" href="../../assets/css/github-gist.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="../../assets/css/ie8.css" /><![endif]-->

		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-135964621-1"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());

			gtag('config', 'UA-135964621-1');
		</script>
	</head>
	<body>
		<div id="page-wrapper">

			<!-- Header -->
				<header id="header">
					<h1><a href="index.html">ArcGIS for Developers</a> 開発リソース集</h1>
					<nav id="nav">
						<ul>
							<li><a href="../../index.html">ホーム</a></li>
							<li><a href="../../tips">技術 Tips 集</a></li>
							<li><a href="../../samples">サンプル集</a></li>
							<li>
								<a href="#" class="icon fa-angle-down">ページ</a>
								<ul>
									<li>
										<a href="#">マップの作成</a>
										<ul>
											<li><a href="../../get-dev-account">アカウントの作成</a></li>
											<li><a href="../../create-feature-service">地図サービスの公開</a></li>
											<li><a href="../../create-webmap">Web マップの作成</a></li>
										</ul>
									</li>
									<li>
										<a href="#">アプリの作成</a>
										<ul>
											<li><a href="../../create-startup-app-js">JavaScript</a></li>
											<li><a href="../../create-startup-app-dotnet">.NET</a></li>
											<li><a href="../../create-startup-app-android">Android</a></li>
											<li><a href="../../create-startup-app-ios">iOS</a></li>
										</ul>
									</li>
									<li>
										<a href="#">認証</a>
										<ul>
											<li><a href="../../authentication">認証パターン</a></li>
											<li><a href="../../register-app">アプリの登録と認証</a></li>
                                            <li><a href="../../proxy-services">プロキシ サービスの利用</a></li>
										</ul>
									</li>
								</ul>
							</li>
							<li><a href="https://github.com/EsriJapan/arcgis-dev-resources" class="button">GitHub <i class="icon fa-github"></i></a></li>
						</ul>
					</nav>
				</header>

				<!-- Main -->
					<section id="main" class="container">
						<header>
							<h2 id="ウィジェット開発">ウィジェット開発</h2>
<p>ウィジェットと呼ばれる、再利用可能な UX コンポーネント作成の基礎を説明します。</p>

						</header>
						<div class="box">
							<p>ウィジェットは再利用可能な UI コンポーネントで、リッチな UX を提供する鍵となります。ArcGIS API for JavaScript はすぐに使えるウィジェットを提供しています。また、バージョン 4.2 からは、独自の機能を持つカスタム ウィジェットを作成する基盤を提供します。</p>
<p>このガイドは、ウィジェット開発の新しいフレームワークへ移行するときに重視すべきトピックを説明することで、ウィジェット開発の基本を説明します。カスタム ウィジェット作成の基盤は、ウィジェットに実装する機能にかかわらず一貫しています。</p>
<blockquote>
<p>このフレームワークはすべての <a href="https://dojotoolkit.org/reference-guide/1.10/dijit/" target="_blank">Dijit</a> を直接差し替えることを意図していません。例えば、<a href="http://dgrid.io/" target="_blank">dgrid</a> の利用には Dijit が必要です。</p>
</blockquote>
<p>トピック</p>
<ul>
<li><a href="#開発要件">開発要件</a></li>
<li><a href="#ウィジェット-ライフサイクル">ウィジェット ライフサイクル</a></li>
<li><a href="#ウィジェットの実装">ウィジェットの実装</a></li>
<li><a href="#typescript-デコレーター">TypeScript デコレーター</a></li>
<li><a href="#サンプルコード">サンプルコード</a></li>
<li><a href="#関連リンク">関連リンク</a></li>
</ul>
<blockquote>
<p>このガイドはウィジェットのフレームワークの大まかな概要を説明しています。どのようにカスタム ウィジェットを作成するかは、<a href="https://developers.arcgis.com/javascript/latest/sample-code/widgets-custom-helloworld/index.html" target="_blank">Hello World</a> や <a href="https://developers.arcgis.com/javascript/latest/sample-code/widgets-custom-recenter/index.html" target="_blank">Recenter widget</a> のサンプルをご参照ください。</p>
</blockquote>
<h2 id="開発要件">開発要件</h2>
<p>カスタム ウィジェットを作成する前に、開発に必要となる要件を確認してください。要件は、作成するウィジェットにより異なります。以下はウィジェット開発に最低限必要な要件です。</p>
<h3 id="typescript">TypeScript</h3>
<p><a href="https://www.typescriptlang.org/" target="_blank">TypeScript</a> は JavaScript のスーパーセットです。TypeScript で書かれたコードは、JavaScript にコンパイルされます。ウィジェット開発には TypeScript を使用することが推奨されています。インターネット上には、TypeScript とは何か、なぜ使われるのか、そしてどのように使うのかを詳細に知ることのできる多数の<a href="https://www.sitepen.com/blog/2013/12/31/definitive-guide-to-typescript" target="_blank">リソース</a>があります。これらの基本を理解することで、ウィジェット開発の過程をより簡単に進めることができます。</p>
<h3 id="jsx">JSX</h3>
<p><a href="https://www.typescriptlang.org/docs/handbook/jsx.html" target="_blank">JSX</a> は HTML と同じようにウィジェットの UI を表現することができる JavaScript の拡張シンタックスです。JSX は HTML に似ており、JavaScript に埋め込んで使用することができます。</p>
<h3 id="esri/core/accessor-の理解">esri/core/Accessor の理解</h3>
<p><a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-core-Accessor.html" target="_blank">Accessor</a> は 4.x の主要な特徴のひとつであり、ウィジェットを含むすべてのクラスの基盤です。どのように動作するのか、使用パターンなどの詳細は <a href="https://developers.arcgis.com/javascript/latest/guide/implementing-accessor/index.html" target="_blank">Implementing Accessor</a> をご参照ください。</p>
<h2 id="ウィジェット-ライフサイクル">ウィジェット ライフサイクル</h2>
<p>開発をはじめる前に、ウィジェット ライフサイクルを理解している必要があります。ウィジェットの種類にかかわらず、ライフサイクル特有の一般的な概念は同じです。</p>
<ol>
<li>constructor (params) - プロパティを設定している間に、ウィジェットが最初に作成されるところです。ウィジェットは Accessor から生じるので、get、set、watch を使いプロパティへアクセスできます（get、set、watch の詳細は <a href="https://developers.arcgis.com/javascript/latest/guide/working-with-props/index.html" target="_blank">Working with properties</a> をご参照ください）。</li>
<li><a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-Widget.html#postInitialize" target="_blank">postInitialize()</a> - このメソッドは、ウィジェット作成後、UI の描画前に呼ばれます。</li>
<li><a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-Widget.html#render" target="_blank">render()</a> - ウィジェット開発で唯一の必須となるメソッドです。UI を描画するために使用されます。</li>
<li><a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-Widget.html#destroy" target="_blank">destroy()</a> - ウィジェットのインスタンスを解放するためのメソッドです。</li>
</ol>
<h2 id="ウィジェットの実装">ウィジェットの実装</h2>
<p>まず、ベースとなる <a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-Widget.html" target="_blank">Widget</a> クラスを拡張することによりウィジェットを作成することからはじめます。</p>
<pre><code class="lang-ts">// 拡張に使用する Widget クラスのインポート
import Widget = require(&quot;esri/widgets/Widget&quot;);

@subclass(&quot;esri.widgets.HelloWorld&quot;)
class HelloWorld extends declared(Widget) {

}
</code></pre>
<p>次に、ウィジェット特有のプロパティとメソッドを実装します。このコードは、プロパティ作成において、デコレーターをどのように利用するのかを示しています。</p>
<pre><code class="lang-ts">// &#39;name&#39; プロパティの作成
@property()
@renderable()
name: string = &quot;John Smith&quot;;

// &#39;emphasized&#39; プロパティの作成
@property()
@renderable()
emphasized: boolean = false;

// プライベートな _onNameUpdate メソッドの作成
private _onNameUpdate(): string { return &#39;${this.name}&#39;;}
</code></pre>
<p>デフォルトでは、要素の中で参照される関数は、実際の要素を参照する <code>this</code> を持ちます。必要に応じて、<code>this</code> の参照先を変更するために <code>bind</code> 属性を使用します。以下では、<code>name</code> プロパティを更新するときに呼ばれる <code>_onNameUpdate</code> コールバック関数を結び付けています。これは次の <a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-Widget.html#postInitialize" target="_blank">postInitialize</a> メソッドに表示されます。</p>
<pre><code class="lang-ts">class HelloWorld extends declared(Widget) {

  constructor() {
    super();
    this._onNameUpdate = this._onNameUpdate.bind(this);
  }

}
</code></pre>
<p><a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-Widget.html#postInitialize" target="_blank">postInitialize</a> メソッドは、ウィジェットのプロパティは用意されているが、描画される前に呼ばれます。以下のコードは <code>name</code> プロパティを監視しています。プロパティが更新されると、<code>_onNameUpdate</code> コールバック関数を呼びます。<code>watchUtils.init()</code> は <a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-core-Accessor.html#WatchHandle" target="_blank">WatchHandle</a> オブジェクトを返し、<code>this.own()</code> に渡されます。これは、ウィジェットを削除した時点で、リソースを解放するメソッドです。</p>
<pre><code class="lang-ts">postInitialize() {
  const handle = watchUtils.init(this, &quot;name&quot;, this._onNameUpdate);

  // ウィジェットが削除された時点でリソースを解放するメソッド
  this.own(handle);
}
</code></pre>
<p>プロパティが実装された後、ウィジェットの UI は <a href="https://www.typescriptlang.org/docs/handbook/jsx.html" target="_blank">JSX</a> を使用して描画されます。これはウィジェットの <a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-Widget.html#render" target="_blank">renderer</a> メソッドに処理されます。</p>
<p>ベースとなる CSS は <code>class</code> 属性に設定されます。class 属性はクラスが変更されないときに使用されます。動的にクラスを変更したいときは、<a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-support-widget.html#classes" target="_blank">classes</a> を使います。これは、切り替え可能な CSS クラスを表すプロパティを持ったオブジェクトです。CSS クラスは、プロパティの値が true のときに追加され、false のときに削除されます。</p>
<pre><code class="lang-ts">// UI の描画
render() {
  const classes = { &quot;hello-world-emphasized&quot;: this.emphasized };
  return (
    &lt;div class = &quot;hello-world&quot; classes={classes}&gt;{this._onNameUpdate()}&lt;/div&gt;
  );
}
</code></pre>
<p><a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-support-widget.html#join" target="_blank">classes</a> と同様に、<code>styles</code> は動的にスタイルを適用することができます。<code>styles</code> のプロパティの値は文字列であることに注意してください。詳細は、<a href="https://developers.arcgis.com/javascript/latest/guide/styling/index.html" target="_blank">Styling</a> トピックをご参照ください。</p>
<pre><code class="lang-ts">render() {
  const dynamicStyles = {
    background-color: this.__hasBackgroundColor ? &quot;chartreuse&quot; : &quot;&quot;
  };

  return (
    &lt;div styles={dynamicStyles}&gt;Hello World!&lt;/div&gt;
  );
}
</code></pre>
<blockquote>
<p><strong>renderer() メソッドは、ウィジェットを実装するために必要となる唯一の必須メソッドです。</strong></p>
</blockquote>
<p>最後に、<code>this.destroy()</code> を呼びます。このメソッドはウィジェットを削除し、<code>postInitialize()</code> 内で参照されている <code>own()</code> メソッドに登録された、すべてのリソースを解放します。</p>
<pre><code class="lang-ts">postInitialize() {
  const handle = watchUtils.init(this, &quot;name&quot;, this._onNameUpdate);

  // ウィジェットが削除された時点でリソースを解放するメソッド
  this.own(handle);
}
</code></pre>
<h3 id="typescript-デコレーター">TypeScript デコレーター</h3>
<p>ウィジェット開発は <a href="https://www.typescriptlang.org/docs/handbook/decorators.html" target="_blank">TypeScript のデコレーター</a>を利用します。デコレーターは、設計時に、既にあるプロパティ、メソッド、コンストラクタの中にある共通する振る舞いを定義、変更します。以下は、ウィジェットで使用される、もっとも一般的なデコレーターです。</p>
<h3 id="`@subclass`（`declared`-と共に使われます）"><code>@subclass</code>（<code>declared</code> と共に使われます）</h3>
<p>これらは、4.x のクラスに結びつけられる基本となるデコレーターです。</p>
<p>以下のコードは <code>esri/widgets/Widget</code> クラスをインポートし、拡張して、<a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-Widget.html#render" target="_blank">renderer</a> メソッド内で UI を定義しています。<a href="https://www.typescriptlang.org/docs/handbook/jsx.html" target="_blank">JSX</a> は UI を定義するために使われています。この例では、<code>div</code> 要素と <code>div</code> 要素内に <code>John Smit</code> が作られます。</p>
<pre><code class="lang-ts">import Widget = require(&quot;esri/widgets/Widget&quot;);

@subclass(&quot;esri.widgets.HelloWorld&quot;)
class HelloWorld extends declared(Widget) {
  render() {
    return (
      &lt;div&gt;John Smith&lt;/div&gt;
    );
  }
}
</code></pre>
<h3 id="`@property()`"><code>@property()</code></h3>
<p>この<a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-core-accessorSupport-decorators.html#property" target="_blank">デコレーター</a>は <a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-core-Accessor.html" target="_blank">Accessor</a> プロパティを定義するために使われます。このデコレーターで定義されたプロパティは、<code>get</code>、<code>set</code>、<code>watch</code> を使用できます。</p>
<pre><code class="lang-ts">@property()
name: string;
</code></pre>
<h3 id="`@renderable()`"><code>@renderable()</code></h3>
<p>この<a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-support-widget.html#renderable" target="_blank">デコレーター</a>は描画をスケジューリングするために使われます。プロパティが修正されたとき、自動的に描画をスケジューリングし、更新します。</p>
<pre><code class="lang-ts">@renderable()
name: string;
</code></pre>
<blockquote>
<p>通常、プロパティを実装するときは、<code>@property()</code> と <code>@renderable()</code> の両方を使います。</p>
<pre><code class="lang-ts">@property()
@renderable()
name: string;
</code></pre>
</blockquote>
<h3 id="`@aliasof()`"><code>@aliasOf()</code></h3>
<p>この<a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-core-accessorSupport-decorators.html#aliasOf" target="_blank">デコレーター</a>はプロパティ エイリアスを定義します。これは、既にあるプロパティが重複しないようにコードを保つために使用されます（例えば ViewModel の内側に既に実装されています）。<em>このガイドで提供するサンプルはこのデコレーターを使っていません。もし、このファイルと関連する <code>HelloWroldViewModel</code> があるとき、この方法を通して直接プロパティへアクセスします。これにより、コードの重複を避けることができます。</em></p>
<pre><code class="lang-ts">@aliasOf(&quot;viewModel.name&quot;)
name: string;
</code></pre>
<h2 id="サンプルコード">サンプルコード</h2>
<p>以下は、このガイドで説明したサンプルコードをまとめたものです。クラスは TypeScript で書かれ、TSX 拡張子で保存されます。TSX 拡張子は、作成するクラスが JSX を使っていることを示しています。</p>
<pre><code class="lang-ts">/// &lt;amd-dependency path=&quot;esri/core/tsSupport/declareExtendsHelper&quot; name=&quot;__extends&quot; /&gt;
/// &lt;amd-dependency path=&quot;esri/core/tsSupport/decorateHelper&quot; name=&quot;__decorate&quot; /&gt;

// Import decorator modules
import {subclass, declared} from &quot;esri/core/accessorSupport/decorators&quot;;
// Import decorator module and jsxFactory used for rendering
import {renderable, jsxFactory} from &quot;esri/widgets/support/widget&quot;;

// Import used to extend off of base Widget class
import Widget = require(&quot;esri/widgets/Widget&quot;);

@subclass(&quot;esri.widgets.HelloWorld&quot;)
class HelloWorld extends declared(Widget) {

  postInitialize() {
    const handle = watchUtils.init(this, &quot;name&quot;, this._onNameUpdate);

    // Helper used for cleaning up resources once the widget is destroyed
    this.own(handle);
  }

  // Create &#39;name&#39; property
  @property()
  @renderable()
  name: string = &quot;John Smith&quot;;

  // Create &#39;emphasized&#39; property
  @property()
  @renderable()
  emphasized: boolean = false;

  // Create private _onNameUpdate method
  private _onNameUpdate(): string { return &#39;${this.name}&#39;;}

  // Render the UI
  render() {
    const classes = { &quot;hello-world-emphasized&quot;: this.emphasized };
    return (
      &lt;div class = &quot;hello-world&quot; join={classes}&gt;{this._onNameUpdate()}&lt;/div&gt;
    );
  }
}

export = HelloWorld;
</code></pre>
<h2 id="関連リンク">関連リンク</h2>
<ul>
<li><a href="https://developers.arcgis.com/javascript/latest/guide/custom-widget/index.html" target="_blank">Widget development</a>（英語）</li>
<li><a href="https://developers.arcgis.com/javascript/latest/sample-code/widgets-custom-helloworld/index.html" target="_blank">Hello World</a>（英語）</li>
<li><a href="https://developers.arcgis.com/javascript/latest/sample-code/widgets-custom-recenter/index.html" target="_blank">Recenter widget</a>（英語）</li>
<li><a href="https://developers.arcgis.com/javascript/latest/api-reference/esri-core-Accessor.html" target="_blank">Accessor class</a>（英語）</li>
<li><a href="https://developers.arcgis.com/javascript/latest/guide/working-with-props/index.html" target="_blank">Guide - Working with properties</a>（英語）</li>
<li><a href="https://developers.arcgis.com/javascript/latest/guide/implementing-accessor/index.html" target="_blank">Implementing Accessor</a>（英語）</li>
<li><a href="https://developers.arcgis.com/javascript/latest/sample-code/widgets-custom-recenter/index.html" target="_blank">Recenter sample</a>（英語）</li>
<li><a href="https://developers.arcgis.com/javascript/latest/guide/styling/index.html" target="_blank">Styling</a>（英語）</li>
<li><a href="https://www.typescriptlang.org/" target="_blank">TypeScript</a>（英語）</li>
<li><a href="https://www.typescriptlang.org/docs/handbook/jsx.html" target="_blank">JSX</a>（英語）</li>
<li><a href="https://esrijapan.github.io/arcgis-dev-resources/javascript/migrating-from-3.x-to-4.0/#プロパティのハンドリング">バージョン 3.x から 4.x への移行</a></li>
</ul>

						</div>
					</section>

				<!-- Footer -->
					<footer id="footer">
						<ul class="icons">
							<li><a href="https://twitter.com/ESRIJapan" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
							<li><a href="https://www.facebook.com/esrijapan" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
							<li><a href="https://github.com/esrijapan" class="icon fa-github"><span class="label">Github</span></a></li>
						</ul>
						<span><img class="ej-logo" src="../../images/logo.png" /></span>
						<ul class="copyright">
							<li>&copy; Esri Japan. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
						</ul>
					</footer>

		</div>

		<!-- Scripts -->
			<script src="../../assets/js/jquery.min.js"></script>
			<script src="../../assets/js/jquery.dropotron.min.js"></script>
			<script src="../../assets/js/jquery.scrollgress.min.js"></script>
			<script src="../../assets/js/skel.min.js"></script>
			<script src="../../assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="../../assets/js/main.js"></script>
			<script src="../../assets/js/highlight.pack.js"></script>
			<script>
				$(function() {
				  hljs.initHighlightingOnLoad();
				});
			</script>
			<script src="../../assets/js/ga.js"></script>

	</body>
</html>
