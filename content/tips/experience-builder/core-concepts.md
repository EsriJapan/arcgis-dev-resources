+++
title = "コア コンセプト"
description = "ArcGIS Experience Builder (Developer Edition) のコア コンセプトについて紹介します。"
weight = 2
aliases = ["/experience/core-concepts/"]
+++

出典：ArcGIS Experience Builder - Guide - [Core concepts](https://developers.arcgis.com/experience-builder/guide/core-concepts/)

### はじめに

Experience Builder は、カスタム ウィジェットの作成、カスタム テーマの作成、カスタム データソース、メッセージ/アクションの作成を通じて拡張することが可能です。これらはすべて、以下のコンポーネントで構成されている`jimu` と呼ばれる Experience Builder の拡張フレームワークを使用することで可能になります。

- ArcGIS API for JavaScript 4.x
- React + Redux フレームワーク
- Bootstrap 4 （UI用）
- HTML5

Experience Builderでウィジェットやテーマなどを開発するには、TypeScript が必要になります。TypeScript を利用するのは、次のようなメリットがあります。

- 型宣言によるエラー検出
- よりよいIDE体験
- セルフ-ドキュメント コード
- より読みやすく、わかりやすい

### Jimu

Jimu は、設定可能なエクスペリエンスを作成するために使用されるJavaScript ライブラリで、以下のようなパッケージで構成される拡張フレームワークです。

- `jimu-core` パッケージは、アプリの設定をロードして解析し、アプリの設定に基づいてレイアウト、テーマ、ウィジェットをロードします。これをサポートするために、本パッケージは WidgetManager、ConfigManager、ThemeManager などのいくつかのクラスを定義しています。また、jimu-core はウィジェットのインターフェイス、いくつかの共通型、およびいくつかの拡張ポイントを定義していますが、これらは他のパッケージやウィジェットにより拡張される可能性があります。
- `jimu-layouts` パッケージは、レイアウト ウィジェットのための、一般的な実装が含まれています。
- `jimu-ui` パッケージは、エクスペリエンスが利用するすべての UI コンポーネントが含まれています。より詳しくは、reactstrap と emotion-js を使用しています。さらに reactstrap に含まれていない、より多くのコンポーネントが追加されています。読み込みサイズを小さくするために、コンポーネントはindex、setting-components、sql-expression-builder などのいくつかのエントリに分割されています。詳細はAPIを参照してください。
- `jimu-arcgis` パッケージは、ArcGIS API for JavaScript 4.x を実行するために必要なすべてのコンポーネントが含まれています。
- `jimu-for-builder` パッケージは、ウィジェットの設定ページの開発をサポートしています。

### データ ソース（Data source）

データソースは、ウィジェットがどのようにデータにアクセスするかを定義します。例えば、データがリモートサーバーからのものである場合、ウィジェットはクライアント側にクエリするために、データソース クラスを使用します。ウィジェットでデータが生成された場合、それ自身をデータソース クラスに入れることで、別のウィジェットで使用することができます。

高レベルでは、データ ソースはスキーマといくつかのレコードを持ち、子/親データ ソースを持つ場合があります。さらに、すべてのデータソースは、それを識別するのに役立つ型、ID、ステータスがあります。
`DataSource` インターフェースは `jimu-core` パッケージで定義されており、これは以下のメソッドとプロパティのいくつかを定義しています。

- `id`: データソースID。
- `type`: どのタイプのデータソースを使っているかチェックするため、ウィジェットで使っているプロパティ。
- `fetchSchema`: すべてのデータソースは、スキーマを返すためにこのメソッドを実装しなければなりません。これは、リモート データ サービスで定義されたスキーマです。例えば、ユーザーがExperience Builder でデータ ソースを追加した場合、データ ソースのスキーマはアプリ構成に保存されません。代わりに、最新のデータ ソース スキーマを取得するために `fetchSchema` メソッドが呼び出されます。
- `getSchema`: ウィジェットがデータソースのスキーマとフィールドにアクセスするために使用するメソッドです。
- `getRecords`: ウィジェットがデータソースのデータレコードにアクセスするために使用するメソッドです。
- `getStatus`: ウィジェットはこのプロパティを使用してデータソースのステータスを取得します。これらのステータスの中には、Loading、Loaded、Errorなどがあります。

1つのデータソースには、サブデータソースを含めることができます。その結果、使いやすくするために複数のデータソースを含めることができます。このようなデータソースを `DataSourceSet` と呼びます。`WebMapDataSource` は`DataSourceSet`です。 `DataSourceSet` も、isDataSourceSet プロパティをtrue に設定していれば、データソースの一種です。データソースは `DataSourceManager` で管理し、データソースの作成や取得を行います。

複数のウィジェットが 1 つのデータ ソースに接続する場合、ウィジェットはデータ ソースのローカル ビューを表示したい場合があります。このシナリオでは、データ ビューを使用します。データ ビューとデータ ソースの関係は、リレーショナル データベースのビューとテーブルの関係に非常に似ています。Experience Builder のデータ ソースは、クライアント側の実際のリモート データ ソースのビューですが、データ ソースはテーブル、データ ビューはビューと考えることができます。アプリ作成者は、データソースからデータ ビューを作成し、ビルダーでデータ ビューにウィジェットを接続することができます。API レベルでは、データ ビューは  `DataSource` クラスを使用して管理されるため、データ ビューは、属性の違いだけでデータ ソースと同じインターフェースとふるまいを持ちます。

データ ソースの使用を簡単にするために、`DataSourceComponent` コンポーネントが定義されています。これは`useDataSource` プロパティを受け取り、コールバックを通じてデータ ソース オブジェクトとそのステータス情報を返します。また、子として関数を受け入れ、データ ソース オブジェクトとデータ ソース内のデータをレンダリングするための情報を取得するために使用することができます。`DataSourceComponent`コンポーネントは、オプションの`query` プロパティを受け入れることもでき、クエリが変更されたときにデータをリロードします。

フィーチャーサービスのような最も一般的に使用されるデータ形式をサポートするために、APIにはQueriableDataSourceインターフェイスと抽象クラスAbstractQueriableDataSourceがあります。このインターフェイスには、url、load、queryなどのプロパティがあります。ロードとクエリの違いは、ロードはレコードのプロパティとデータソースのステータスを更新し、クエリはレコードのみをクエリして返すことです。

具体的には、Experience Builderで`FeatureLayerDataSource`データソースを定義して、フィーチャレイヤーにアクセスします。データ ソースがスタンドアロンのフィーチャ レイヤから作成された場合、オブジェクトには `layer` プロパティはありません。ウェブマップ/ウェブシーンに含まれるフィーチャ レイヤから作成された場合、オブジェクトには `layer` プロパティがあり、これは ArcGIS API for JavaScript の FeatureLayer オブジェクトです。

一般的にデータソースは2つの場所に保存され、データソースオブジェクトは `DataSourceManager` に保存・管理され、データソース情報はredux アプリ ストアに保存されます。`ataSourceComponent` を使う場合、コンポーネントは`DataSourceManager` を呼び出してオンデマンドでデータソースを作成し、コールバック プロップを使ってデータ ソース オブジェクトと`dataSourceInfo` を返します。`dataSourceInfo` では、データソースの `instanceStatus`, `status`, `selectedIds` などを返すことができます。

ArcGIS Serverサービスの多くは、`MapServiceDataSource`、`FeatureServiceDataSource` など、アクセスしやすいようにデータソースにマッピングされています。 ArcGIS API for JavaScript の `WebMap` と `WebScene` は、jimu-arcgis パッケージ内で`WebMapDataSource` と `WebSceneDataSource` としてラップされています。

### リピート データ ソース（Repeated Data source）

RepeatedDataSourceProvider が提供するデータソースをリピートデータソースと呼びます。データソースを提供するウィジェットのすべての子ウィジェットは、リピートデータソースを受け取ります。これはReact のContext と似ています。ウィジェットはthis.props.repetedDataSource でリピートデータソースにアクセスできます。リピートデータソースは、データソースの ID、レコード、レコードインデックスを取得します。
どのウィジェットでも、RepeatedDataSourceProviderを使用してリピートデータソースを提供することができます。Experience BuilderのListウィジェットは、リピートデータソースを提供する良い例です。リピートデータソースを使用するには、ウィジェットのマニフェストファイルに supportRepeat プロパティを追加します。

### マップ/シーン ビュー（Map/Scene View）

ビューの概念はArcGIS API for JavaScript と同じですが、Experience Builder では、ウィジェットやメッセージ/アクションなどを作成する際に一貫した拡張性モデルを確保するために、ビューは `JimuMapView` としてラップされます。`JimuMapView` オブジェクトを作成するには、ウィジェットは `JimuMapViewManager.createJimuMapView()` メソッドを使用します。`JimuMapView` オブジェクトは、主に以下のプロパティを持っています。

- `view`: マップ/シーン ビュー オブジェクト
- `datasourceId`: ビューを作成するデータソース (webmap/webscene)
- `mapWidgetId`: オブジェクトを作成するビュー
- `jimuLayerViews`: レイヤー ビュー オブジェクトのラッパー

マップ/シーン ビューを使用する必要があるウィジェットは、設定ページの`JimuMapViewSelector` コンポーネントを使用してマップ/シーンビューを選択することができます。これも`JimuMapViewComponent` を使用してJimuMapViewオブジェクトにアクセスします。

### ページ（Page）

エクスペリエンスの中のページは、物理的なHTML Web ページでなく、概念的なページですが、実際のHTML Web ページのように振る舞います。これは `div` HTMLタグを使って実装されます。エクスペリエンスは少なくとも1つのページを持たなければならず、複数のページを持つこともできます。Experience Builder のページレイアウトにはフルスクリーンのアプリページと直線的なスクロールページの2種類があり、前者はアプリのように見え、後者はウェブページのように見えます。

ページの内容（ウィジェット/セクション）は、固定レイアウトやフローレイアウトなどのレイアウトルールで整理されています。異なる画面サイズでもページが反応するようにするために、Experience Builderはサイズモードによるレイアウトの設定をサポートしています。これらは `Large`, `Medium`, `Small` で定義されています。各レイアウトの設定はエクスペリエンスの適応であり、アプリケーションをよりカスタマイズし、画面サイズをより有効に利用できるようにすることで、より大きな柔軟性を提供します。このデザインの良い例としては、[City Explorerのテンプレート](https://experience.arcgis.com/template/29ffe9b151654bd4992bff0baae4a6bd/)があります。アプリケーションを大・中画面で見た場合、地図は表示され、構成に含まれていますが、モバイルデバイスで見た場合、地図ウィジェットは最初のページから削除され、ユーザーがリストウィジェットで機能を選択した後、2番目のページにのみ表示されるようになります。

### ウィンドウ（Window）

ウィンドウはページに似ていて、任意のウィジェットを追加することができ、コンテンツを表示するための2つの設定（固定とアンカー設定）があります。
固定ウィンドウはモーダルを作成し、メインウィンドウを無効にしますが、ユーザーがエクスペリエンスに戻る前にウィンドウと対話できるように表示を維持します。固定ウィンドウはスプラッシュスクリーンとして使用したり、ページで開いたり、ウィジェットから開いたりすることができます。アンカー ウィンドウは、ボタンやテキストウィジェットなどのウィジェットからトリガーされます。

### テーマ（Theme）

テーマは、エクスペリエンスの外観と使用感を定義します。エクスペリエンスは、すぐに使える(OOB)テーマがあり、カスタムテーマの作成も可能です。テーマ開発については、[theme development](https://developers.arcgis.com/experience-builder/guide/theme-development/) をご覧ください。

### ウィジェット（Widget）

ウィジェットは設定可能な機能単位で、エクスペリエンスなページを作成するために使用されるビルディングブロックです。Experience Builder は、マップ、ボタン、リストなどのすぐに使える（OOB）ウィジェットが用意されており、カスタムウィジェットを作成することも可能です。ウィジェットは通常、ユーザーがビルダー環境で機能を設定できるように設定UIを提供します。ウィジェットに設定可能なオプションがありますが、設定 UI が含まれていない場合は、JSON エディタを使用して設定することが可能です。

ウィジェットの実装については、[widget implementation](https://developers.arcgis.com/experience-builder/guide/extend-base-widget/) をご覧ください。

### メッセージ と アクション（Message and action）

メッセージ/アクションは、ウィジェットからウィジェット、ウィジェットからフレームワーク、フレームワークからウィジェットへの通信をサポートする方法です。
ウィジェット/フレームワークはメッセージを公開したり、メッセージを聞いたりすることができます。メッセージは jimu フレームワークによって定義される `MessageType` によって識別されます。jimu には `ExtentChange` や `DataRecordsSelectionChange` のようないくつかのメッセージタイプが定義されています。今後のリリースでは、より多くのメッセージタイプが追加される予定です。

メッセージ/アクションの作成方法は、[message and action](https://developers.arcgis.com/experience-builder/guide/message-action/) をご覧ください。