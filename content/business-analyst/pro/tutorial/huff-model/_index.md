+++
title = "ハフ モデル"
description = "ハフ モデルを実行して、ポテンシャルの吸引率をシミュレーションします。"
weight = 18
alwaysopen = false
data = 2022-05-22T10:00:00+09:00
author = "石橋"
draft = false
+++

{{< callout >}}

本演習にかかる時間はおよそ 20 分です。

{{< /callout >}}

# 目的

出店候補地を起点としたハフ モデルを実行し、需要 (ポテンシャル) の吸引をシミュレーションする方法を習得します。なお、本演習ではポテンシャル データとして 500m メッシュに格納された人口総数を用います。

{{< callout >}}

ハフ モデルの詳細は、<a href="https://business-map.esrij.com/glossary/2021/" target="_blank">ビジネスマップ用語集</a>をご覧ください。

{{< /callout >}}

{{< callout >}}

本演習では、人口総数をポテンシャル データとして使用するため、算出される結果は「吸引人口」となります。
推計消費額などをポテンシャル データに設定すると、ハフ モデルを用いた需要予測の結果を金額ベースで得ることができます。

{{< /callout >}}

# 演習

## 演習用データのダウンロード

1. <a href="https://www.arcgis.com/home/item.html?id=73190eaba36d495dab9efa88bfca8f9d" target="_blank">BA Pro チュートリアル-ハフモデル プロジェクトパッケージ</a>をダウンロードします。
2. ダウンロードした「BAProチュートリアル-ハフモデル.ppkx」を開き、[演習1] マップを開きます。

[コンテンツ] ウィンドウおよびマップ上に「出店候補地」レイヤーおよび「既存店」レイヤーが追加されていることを確認します。

{{< figure src="https://s3.ap-northeast-1.amazonaws.com/doc.esrij.com/business-analyst/pro/tutorial/huffmodel/huff-input-data.png" title="出店候補地および既存店ポイント" >}}

{{< callout >}}

[Business Analyst データ ソース](/business-analyst/pro/tutorial/prepare-for-tutorial/#business-analyst-データ-ソースの設定) が最新のデータセットに設定されていることをご確認ください。

{{< /callout >}}

{{< callout >}}

既存店のポイント データには、自社店舗と競合店舗の両方が含まれます。

{{< /callout >}}

## ハフモデルの解析範囲の設定

ハフモデルの吸引シミュレーションを実行する範囲を設定します。本演習では、出店候補地を起点とした運転時間 10 分圏を解析範囲とします。

1. ArcGIS Pro 上部の [コマンド検索] で「道路距離」と入力します。
2. 検索結果の中の [<a href="https://pro.arcgis.com/ja/pro-app/latest/tool-reference/business-analyst/generate-drive-time-trade-area.htm" target="_blank">道路距離/時間商圏の生成 (Generate Drive Time Trade Areas)</a>] ツールをクリックして開きます。
3. ツールを以下のように設定して、[実行] します。 
    パラメーター | 設定値
    -- | --
    入力フィーチャ | 出店候補地
    出力フィーチャクラス | 出店候補地_車10分圏
    距離タイプ | 運転時間
    入力方法 | 値
    距離 | 10
    距離単位 | 分

マップに、出店候補地を起点とした自動車 10 分圏が追加されます。
{{< figure src="https://s3.ap-northeast-1.amazonaws.com/doc.esrij.com/business-analyst/pro/tutorial/huffmodel/drivetime-10min.png" title="車で 10 分商圏" >}}

## ハフモデル用ポテンシャルレイヤーの抽出

ハフ モデル実行時のポテンシャル レイヤーとして利用するために、運転時間商圏に重なる 500m メッシュを選択します。

1. [解析] タブ → [ワークフロー] グループの [ビジネス解析] → [カラーコード レイヤー] を選択します。
2. [人口] → [人口総数] → [2020 人口総数 (国勢調査)] から [2020 人口総数] を選択し、[OK] をクリックします。

[シンボル - カラー コード レイヤー] パネルが表示されます。

3. [区画] → [対象地域] 横の [v] ボタンをクリックして、[境界レイヤー] に [出店候補地_車10分圏] レイヤーを選択します。
4. [詳細レベル] を [4次メッシュ] に切り替えます。

[コンテンツ] ウィンドウに「カラー コード レイヤー」という名前のグループ レイヤーが追加され、マップに人口総数で色分けされたメッシュ ポリゴンが追加されます。

## ハフ モデルの実行

あらかじめ追加されている「出店候補地」および「既存店」のポイント データ、運転時間商圏に重なる 500m メッシュを用いて、ハフ モデルを実行します。

1. [解析] タブ → [ワークフロー] グループの [ビジネス解析] ボタン → [ハフ モデルの実行] をクリックします。
2. [<a href="https://pro.arcgis.com/ja/pro-app/latest/tool-reference/business-analyst/huff-model.htm" target="_blank">ハフ モデル (Huff Model)</a>] ツールを以下のように設定して、[実行] します。
    パラメーター | 設定値
    -- | --
    入力施設フィーチャ | 既存店
    施設 ID フィールド | 店舗ID
    入力候補地フィーチャ | 出店候補地
    候補地 ID フィールド | 店舗ID
    入力ポテンシャル フィーチャ | カラー コード レイヤー\4次メッシュ
    ポテンシャル ID フィールド | ID
    ポテンシャル フィールド | 2020 人口総数
    出力フィーチャクラス | ハフモデル
    魅力度の変数 | 既存施設の値: 売場面積<br/>候補地の値: 売場面積<br/>指数: 1
    距離指数 | -1.5
    距離タイプ | 運転時間
    距離単位 | 分

{{< callout >}}

本演習では魅力度を 1 つだけ設定していますが、魅力度を複数設定することも可能です。[魅力度の変数] パラメーターの [他を追加] ボタンをクリックすることで追加の魅力度を設定できます。

{{< /callout >}}

{{< callout >}}

[距離指数] パラメーターでは「**距離抵抗係数**」を指定できます。距離抵抗係数は、距離に応じて吸引される需要がどれだけ減少するかを定義したもので、買い回り品と最寄り品の調整を行うことができます。一般的には、食料品などの最寄り品では距離抵抗係数を高く設定し、家具などの買回り品では距離抵抗係数は低く設定します。<br/>
また、[距離タイプ] パラメーターでは、距離計測の方法を直線距離、道路距離、道路時間のいずれかから指定できます。

{{< /callout >}}

マップにハフ モデルの結果レイヤーが追加されます。このレイヤーは、算出された需要の吸引率を元に色分けされており、赤いエリアほど吸引率が高いことを表しています。今回の結果を見ると、出店候補地の西側のエリアには既存店が無く、より吸引率が高いことが分かります。

{{< figure src="https://s3.ap-northeast-1.amazonaws.com/doc.esrij.com/business-analyst/pro/tutorial/huffmodel/huffmodel-result.png" title="ハフ モデルの解析結果およびツールの設定内容" >}}

## 解析結果の確認

最後に「データ エンジニアリング」機能を用いて、ハフ モデルの解析結果を確認します。

{{< callout >}}

データ エンジニアリングは、空間解析やデータ サイエンスにおいて役立つツールをまとめたものです。マップやチャートを使ってデータを探索したり、統計情報を表示してデータの値や分布を把握することができます。詳細は <a href="https://pro.arcgis.com/ja/pro-app/latest/help/analysis/geoprocessing/data-engineering/what-is-data-engineering.htm" target="_blank">Esri ヘルプ</a>をご参照ください。

{{< /callout >}}

1. [コンテンツ] ウィンドウの「ハフモデル」レイヤー上で右クリック → [データ エンジニアリング] をクリックします。
2. データ エンジニアリング ビュー左部のフィールド パネルに「ハフモデル」レイヤーが持つフィールドの一覧が表示されます。「合計」フィールド上にマウス カーソルを合わせて、3 つのボタンの一番左側の [シンボルの更新] ボタンをクリックします。

{{< callout >}}

ハフモデル ツールで生成される各フィールドは、以下の内容を表します。<br/>

<div class="info-table">

|フィールド名|説明|
|:--|:--|
|ID|エリアの一意な ID を表します。|
|確率|エリアの出店候補地における需要の「吸引率」を表します。|
|合計|エリアの出店候補地における「吸引需要」を表します。本演習では、ポテンシャルとして人口総数を設定したので、人口総数 × 吸引率 = 吸引人口を表します。|
</div>
<br/>

{{< /callout >}}

「ハフモデル」レイヤーのシンボルを、吸引率ベースから吸引人口ベースにワンクリックで変更できました。

{{< callout >}}

ctrl + Z キーを押すと、変更前のシンボルに戻すことができます。

{{< /callout >}}

3. フィールド パネルで「合計」フィールドをクリックして選択し、右側の統計情報パネルにドラッグ & ドロップして追加します。
4. [計算] ボタンをクリックして、追加したフィールドの統計情報を算出します。

算出された統計情報のうち [合計] を確認することで、出店候補地が吸引する「吸引人口」の合算値を確認できます。

{{< figure src="https://s3.ap-northeast-1.amazonaws.com/doc.esrij.com/business-analyst/pro/tutorial/huffmodel/confirm-huff-result.png" title="結果の詳細を確認" >}}

5. [プロジェクト] タブ → [保存] を選択し、<a href="https://pro.arcgis.com/ja/pro-app/latest/help/projects/save-a-project.htm" target="_blank">プロジェクトを保存</a>します。

# まとめ

この演習では、新規出店候補地 1 ヶ所から運転時間商圏を作成し、それに重なる 500m メッシュを選択しました。そして、出店候補地および既存店のポイント データと選択した 500m メッシュを用いてハフ モデルを実行しました。
更に、データ エンジニアリング機能を用いて、ハフ モデルの解析結果の詳細を確認することができました。

また、以下ツールの操作について学びました。

- [道路距離/時間商圏の生成] ツール
- [カラー コード レイヤー] ツール
- [空間条件で選択] ツール
- [ハフ モデル] ツール
- データ エンジニアリング

<style class="info-table">
table {
    font-size: 13px;
    width: 85%;
    margin-right: 5px;
    margin-left: 15px;
}
table th:first-of-type {
    width: 30%;
    }
table th:nth-of-type(2) {
    width: 70%;
    }
table tr{
    background-color: #ffffff;
}
</style>

